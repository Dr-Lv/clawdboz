#!/usr/bin/env python3
"""
分析飞书消息类型的可行性

飞书 im/v1 消息 API 支持的消息类型：
1. text - 纯文本（不会退化成图片）
2. image - 图片（需要上传图片获取 image_key）
3. file - 文件
4. interactive - 互动卡片（会退化成预览图）
5. markdown - Markdown 格式（部分支持）
6. post - 富文本（复杂格式）

问题：卡片消息(interactive)会被飞书服务器渲染成预览图，导致：
- 预览图的 image_key 权限受限
- Bot 无法下载自己的卡片预览图
"""

feasibility_analysis = """
## 📊 替代方案可行性分析

### 方案 1: 使用纯文本格式 (text)
**优点**:
- ✅ 不会退化成图片，无权限问题
- ✅ 支持完整的文本内容
- ✅ 支持 Markdown 语法（部分）

**缺点**:
- ❌ 无法渲染代码块高亮
- ❌ 无法渲染表格
- ❌ 无法使用卡片的美化样式
- ❌ 长消息可读性差

**可行性**: ⭐⭐⭐⭐⭐ 高

---

### 方案 2: 使用富文本格式 (post)
**优点**:
- ✅ 支持多种格式（文本、链接、@等）
- ✅ 不会退化成图片

**缺点**:
- ❌ 不支持代码块
- ❌ 格式转换复杂
- ❌ 兼容性不如 text

**可行性**: ⭐⭐⭐ 中

---

### 方案 3: 使用 Markdown 格式
**优点**:
- ✅ 支持 Markdown 语法
- ✅ 不会退化成图片

**缺点**:
- ❌ 飞书 Markdown 支持有限
- ❌ 代码块、表格支持不完整

**可行性**: ⭐⭐⭐ 中

---

### 方案 4: 文本 + 图片分离发送
**优点**:
- ✅ 文本用 text 类型
- ✅ 代码/复杂内容截图发送 image
- ✅ 图片本地保存，可追踪

**缺点**:
- ❌ 需要生成图片（截图）
- ❌ 实现复杂度高
- ❌ 多条消息可能打乱阅读顺序

**可行性**: ⭐⭐ 低（实现复杂）

---

### 方案 5: 继续使用卡片，但接受限制
**优点**:
- ✅ 最佳用户体验
- ✅ 支持代码块、表格、Markdown
- ✅ 美观的卡片样式

**缺点**:
- ❌ 卡片预览图无法下载
- ❌ 聊天记录中 Bot 消息显示为 "[图片/卡片回复]"

**可行性**: ⭐⭐⭐⭐ 中（当前方案）

---

## 🎯 推荐方案

### 短期（保持现状）:
继续使用卡片格式，接受以下限制：
- 用户上传的图片/文件 ✅ 正常下载
- Bot 发送的卡片预览图 ⚠️ 显示 "无法获取" 提示

### 中期（混合方案）:
根据内容类型自动选择格式：
- 简单回复 -> text 格式
- 复杂回复（代码/表格）-> interactive 卡片

### 长期（最佳方案）:
改造为文本优先，复杂内容本地渲染后截图发送：
- Markdown 渲染成本地图片
- 文本 + 图片组合发送
- 本地保存所有图片
"""

print(feasibility_analysis)
